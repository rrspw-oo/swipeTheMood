# Backend Database Documentation

## Overview
This document describes the database architecture, schema design, and data management strategy for the QuoteSwipe application.

**Technology:** Firebase Firestore (NoSQL Document Database)
**Status:** ðŸ“‹ **Planning Phase** - Database not yet implemented

---

## Database Architecture

### Firebase Firestore Structure
```
project-root/
â”œâ”€â”€ quotes/              (Collection)
â”‚   â”œâ”€â”€ {quoteId}/      (Document)
â”‚   â”‚   â”œâ”€â”€ text        (Field)
â”‚   â”‚   â”œâ”€â”€ author      (Field)
â”‚   â”‚   â”œâ”€â”€ moods       (Array Field)
â”‚   â”‚   â””â”€â”€ createdAt   (Timestamp Field)
â”‚   â””â”€â”€ ...
â”œâ”€â”€ users/              (Future Collection)
â”‚   â””â”€â”€ {userId}/
â””â”€â”€ analytics/          (Future Collection)
    â””â”€â”€ {eventId}/
```

---

## Collections

### quotes Collection

**Purpose:** Stores all wisdom quotes and sayings

**Document ID:** Auto-generated by Firestore
**Document Structure:**
```javascript
{
  text: string,           // Quote content (required, max 500 chars)
  author: string,         // Author name (optional, max 100 chars)
  moods: string[],        // Array of mood categories (required, min 1)
  createdAt: timestamp,   // Creation timestamp (auto-generated)
  updatedAt: timestamp    // Last update timestamp (optional)
}
```

**Example Document:**
```javascript
// Document ID: "xR3kL9pMn2QvC8sA1B"
{
  text: "Stay hungry, stay foolish.",
  author: "Steve Jobs",
  moods: ["innovation", "excited"],
  createdAt: Timestamp(2024, 1, 3, 12, 0, 0),
  updatedAt: Timestamp(2024, 1, 3, 12, 0, 0)
}
```

### Mood Categories
Valid values for `moods` array:
- `"excited"` - Quotes for staying humble when things go well
- `"innovation"` - Zero-to-one thinking, creativity, leadership
- `"not-my-day"` - Resilience, pushing through tough times
- `"reflection"` - Deep wisdom, life philosophy, contemplation

---

## Indexes

### Required Indexes

#### 1. Mood Filtering Index
```javascript
{
  collection: "quotes",
  fields: [
    { field: "moods", mode: "ARRAY_CONTAINS" },
    { field: "createdAt", mode: "DESCENDING" }
  ]
}
```
**Purpose:** Enable efficient filtering by mood with chronological ordering

#### 2. Author Index
```javascript
{
  collection: "quotes",
  fields: [
    { field: "author", mode: "ASCENDING" },
    { field: "createdAt", mode: "DESCENDING" }
  ]
}
```
**Purpose:** Future feature - browse quotes by specific author

### Automatic Indexes
Firestore automatically creates single-field indexes for:
- `text` (for future search functionality)
- `author` (for filtering)
- `createdAt` (for ordering)

---

## Security Rules

### Firestore Security Rules
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Quotes collection
    match /quotes/{quoteId} {
      // Allow public read access
      allow read: if true;

      // Only admin users can create/update/delete
      allow create, update, delete: if request.auth != null
        && request.auth.token.admin == true;

      // Validate quote data structure
      allow create, update: if validateQuote(request.resource.data);
    }

    // Future: User profiles (private)
    match /users/{userId} {
      allow read, write: if request.auth != null
        && request.auth.uid == userId;
    }
  }

  // Quote validation function
  function validateQuote(quote) {
    return quote.keys().hasAll(['text', 'moods', 'createdAt']) &&
           quote.text is string &&
           quote.text.size() > 0 &&
           quote.text.size() <= 500 &&
           quote.moods is list &&
           quote.moods.size() > 0 &&
           isValidMoodArray(quote.moods) &&
           ((!('author' in quote)) || quote.author is string);
  }

  // Mood validation function
  function isValidMoodArray(moods) {
    let validMoods = ['excited', 'innovation', 'not-my-day', 'reflection'];
    return moods.hasOnly(validMoods);
  }
}
```

---

## Data Seeding

### Initial Quote Dataset
Based on current mock data, populate with 20+ quotes from:

**Authors to Include:**
- **Charlie Munger** (3 quotes) - Investment wisdom, rational thinking
- **Steve Jobs** (3 quotes) - Innovation, design philosophy
- **Elon Musk** (2 quotes) - First principles, boundary pushing
- **Peter Thiel** (3 quotes) - Zero-to-one concepts, monopoly thinking
- **Adam Grant** (2 quotes) - Originality, learning from failure
- **Benjamin Franklin** (2 quotes) - Knowledge, preparation
- **BjÃ¶rn Natthiko Lindeblad** (2 quotes) - Happiness, life philosophy
- **Kevin Kelly** (2 quotes) - Future thinking, optimism
- **Classical Wisdom** (2 quotes) - Socrates, Warren Buffett on humility

### Seeding Script Structure
```javascript
// Firebase Admin SDK script
const admin = require('firebase-admin');
const serviceAccount = require('./service-account-key.json');

admin.initializeApp({
  credential: admin.credential.cert(serviceAccount)
});

const db = admin.firestore();

const quotes = [
  {
    text: "It is remarkable how much long-term advantage people like us have gotten by trying to be consistently not stupid, instead of trying to be very intelligent.",
    author: "Charlie Munger",
    moods: ["excited", "reflection"],
    createdAt: admin.firestore.Timestamp.now()
  },
  // ... more quotes
];

async function seedDatabase() {
  const batch = db.batch();

  quotes.forEach(quote => {
    const ref = db.collection('quotes').doc();
    batch.set(ref, quote);
  });

  await batch.commit();
  console.log('Database seeded successfully');
}
```

---

## Backup and Recovery

### Automatic Backups
```javascript
// Firebase backup configuration
{
  "retention": "30d",
  "frequency": "daily",
  "time": "02:00 UTC"
}
```

### Export/Import Strategy
```bash
# Export all quotes
gcloud firestore export gs://your-backup-bucket/quotes-backup-$(date +%Y%m%d)

# Import from backup
gcloud firestore import gs://your-backup-bucket/quotes-backup-20240101
```

---

## Performance Optimization

### Query Optimization
```javascript
// Efficient mood-based query
const quotesRef = collection(db, 'quotes');
const q = query(
  quotesRef,
  where('moods', 'array-contains', 'innovation'),
  orderBy('createdAt', 'desc'),
  limit(20)
);

// Use pagination for large result sets
const nextQ = query(
  quotesRef,
  where('moods', 'array-contains', 'innovation'),
  orderBy('createdAt', 'desc'),
  startAfter(lastDocument),
  limit(20)
);
```

### Caching Strategy
- **Client-side:** Cache results for 5-10 minutes
- **CDN:** Cache static content at edge locations
- **Firestore:** Automatic caching for frequently accessed documents

---

## Monitoring and Metrics

### Database Metrics to Track
```javascript
// Key performance indicators
{
  "read_operations_per_day": "number",
  "write_operations_per_day": "number",
  "delete_operations_per_day": "number",
  "document_count": "number",
  "storage_size_gb": "number",
  "average_query_time_ms": "number"
}
```

### Alerts Configuration
- Read operations > 10,000/day
- Write operations > 100/day (unusual for quote app)
- Query time > 1000ms
- Error rate > 1%

---

## Scaling Considerations

### Current Limitations
- Firestore free tier: 50,000 read operations/day
- Document size limit: 1MB (not relevant for quotes)
- Maximum 1 write per second per document

### Scaling Solutions
```javascript
// Sharding for high write volumes (if needed)
const shardId = Math.floor(Math.random() * 10);
const shardedRef = collection(db, `quotes_shard_${shardId}`);

// Aggregation for analytics
const statsRef = doc(db, 'stats', 'daily_stats');
increment(statsRef, {
  totalQuotesViewed: 1,
  moodBreakdown: {
    [selectedMood]: 1
  }
});
```

---

## Future Collections

### users Collection (Planned)
```javascript
{
  uid: string,              // Firebase Auth UID
  displayName: string,      // User display name
  email: string,            // User email
  preferences: {
    favoriteQuotes: string[], // Array of quote IDs
    preferredMoods: string[], // Default mood preferences
    theme: string             // UI theme preference
  },
  createdAt: timestamp,
  lastLoginAt: timestamp
}
```

### analytics Collection (Planned)
```javascript
{
  eventType: string,        // 'quote_view', 'mood_select', 'swipe'
  quoteId: string,          // Reference to quote
  mood: string,             // Selected mood (if applicable)
  userId: string,           // User ID (if authenticated)
  timestamp: timestamp,
  sessionId: string         // Session identifier
}
```

---

## Migration Strategy

### Development to Production
1. **Schema validation** - Ensure all documents match expected structure
2. **Index creation** - Apply all required indexes before launch
3. **Security rules testing** - Validate rules with Firebase emulator
4. **Backup verification** - Test backup and restore procedures
5. **Performance testing** - Load test with expected query patterns